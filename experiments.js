// ---------------------------------------
// IMPORTANT STUFF PAST HERE!
// ---------------------------------------

function flashColors1(ss) {
  void (async function () {
    const colors = ["#ffcc00", "#55d099", "#ff3b30", "#336ce7"];
    for (let i = 0; i < 10; i++) {
      ss.setTabColor(colors[i % colors.length]);
    }
    ss.setTabColor(null);
  })();
}

// Collapse me
const pixels = [
  [
    76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76,
    76, 76, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76,
    76, 76, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76,
    76, 76, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 233, 233, 233, 76, 76, 76, 76,
    76, 76, 76, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 255, 255, 255, 76, 76, 76, 76,
    76, 76, 76, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 255, 255, 255, 76, 76, 76, 76,
    76, 76, 76, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 76, 80, 184, 227, 233, 233, 233, 255, 255, 255, 233, 233,
    233, 233, 233, 233, 135, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 76, 216, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    255, 255, 255, 255, 147, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 127, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    255, 255, 255, 255, 147, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 144, 255, 255, 255, 255, 255, 241, 139, 139, 139, 139, 139,
    139, 139, 139, 139, 94, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 107, 251, 255, 255, 255, 255, 206, 76, 76, 76, 76, 76, 76,
    76, 76, 76, 76, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 76, 176, 251, 255, 255, 234, 103, 76, 76, 76, 76, 76, 76,
    76, 76, 76, 76, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 76, 76, 112, 176, 158, 77, 76, 76, 76, 76, 76, 93, 171, 178,
    139, 76, 76, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 118, 242, 255, 255,
    255, 178, 76, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 211, 255, 255, 255,
    255, 253, 110, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 107, 178, 178, 178, 178, 178, 178, 178, 178, 178, 242, 255,
    255, 255, 255, 255, 144, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 139, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    255, 255, 255, 255, 120, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 139, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    255, 255, 255, 203, 76, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 119, 209, 209, 209, 209, 209, 211, 255, 255, 255, 214, 208,
    208, 208, 170, 76, 76, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 255, 255, 255, 76, 76, 76, 76,
    76, 76, 76, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 255, 255, 255, 76, 76, 76, 76,
    76, 76, 76, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 233, 233, 233, 76, 76, 76, 76,
    76, 76, 76, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76,
    76, 76, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76,
    76, 76, 76, 76, 76, 76,
  ],
  [
    76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76,
    76, 76, 76, 76, 76, 76,
  ],
];

// Set a 25 x 25 area of 21px square cells
function prepareCanvas() {
  const ss = SpreadsheetApp.getActiveSheet();
  ss.setColumnWidths(1, 25, 21);
}

// Set columns back to 100px wide
function resetCanvas() {
  const ss = SpreadsheetApp.getActiveSheet();
  ss.setColumnWidths(1, 25, 100);
  const canvas = ss.getRange(2, 1, 25, 25);
  // Reset the backgrounds
  canvas.setBackgrounds(pixels.map((row) => row.map(() => null)));
}

// Render the image in the given color
function renderImage([_red, _green, _blue]) {
  const colors = pixels.map((row) =>
    row.map((lightness) => {
      const pad = (n) => (n.length === 2 ? n : `0${n}`);
      const factor = (lightness / 255) * 1.5;
      const red = pad(Math.min(parseInt(_red * factor), 255).toString(16));
      const green = pad(Math.min(parseInt(_green * factor), 255).toString(16));
      const blue = pad(Math.min(parseInt(_blue * factor), 255).toString(16));
      return `#${red}${green}${blue}`;
    })
  );
  const ss = SpreadsheetApp.getActiveSheet();
  const canvas = ss.getRange(2, 1, 25, 25);
  canvas.setBackgrounds(colors);
  SpreadsheetApp.flush();
}

function sleep(ms) {
  Utilities.sleep(ms);
}

function flashImage() {
  prepareCanvas();

  const colors = [
    [255, 204, 0],
    [85, 208, 153],
    [255, 59, 48],
    [51, 108, 231],
  ];

  for (let i = 0; i < 8; i++) {
    renderImage(colors[i % colors.length]);
  }

  resetCanvas();
}
